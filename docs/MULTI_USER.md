# ğŸ‘¥ å¤šç”¨æˆ·åŠŸèƒ½ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨å¤šç”¨æˆ·åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€ç™»å½•å’Œè‚¡ç¥¨åˆ—è¡¨éš”ç¦»ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šç”¨æˆ·æ”¯æŒ** - æ”¯æŒå¤šä¸ªç”¨æˆ·è´¦å·
- âœ… **ç”¨æˆ·éš”ç¦»** - æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„è‚¡ç¥¨åˆ—è¡¨
- âœ… **ç®¡ç†å‘˜åŠŸèƒ½** - ç®¡ç†å‘˜å¯ä»¥æ·»åŠ /åˆ é™¤ç”¨æˆ·
- âœ… **Session è®¤è¯** - ä½¿ç”¨ Cookie Session ä¿æŒç™»å½•çŠ¶æ€
- âœ… **å‘åå…¼å®¹** - å…¼å®¹å•ç”¨æˆ· Basic Auth æ¨¡å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–ç®¡ç†å‘˜è´¦æˆ·

é¦–æ¬¡ä½¿ç”¨éœ€è¦åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š

```bash
python init_admin.py admin mypassword123
```

è¿™å°†åˆ›å»ºï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`mypassword123`
- è§’è‰²ï¼šç®¡ç†å‘˜

### 2. å¯åŠ¨ WebUI

```bash
# é»˜è®¤ç›‘å¬ 0.0.0.0:8000ï¼ˆå…è®¸å¤–éƒ¨è®¿é—®ï¼‰
python main.py --webui-only

# æˆ–æŒ‡å®šç›‘å¬åœ°å€å’Œç«¯å£
python main.py --webui-only --webui-host 0.0.0.0 --webui-port 8000

# ä»…æœ¬åœ°è®¿é—®
python main.py --webui-only --webui-host 127.0.0.1
```

æˆ–ä½¿ç”¨ Docker/Podmanï¼š

```bash
docker-compose -f ./docker/docker-compose.yml up -d webui
# æˆ–
podman compose -f ./docker/podman-compose.yml up -d webui
```

### 3. ç™»å½•

è®¿é—® `http://localhost:8000/login`ï¼Œä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ã€‚

## ğŸ‘¤ ç”¨æˆ·ç®¡ç†

### ç®¡ç†å‘˜åŠŸèƒ½

ç®¡ç†å‘˜ç™»å½•åï¼Œå¯ä»¥è®¿é—®ç”¨æˆ·ç®¡ç†é¡µé¢ï¼š`http://localhost:8000/admin/users`

#### æ·»åŠ ç”¨æˆ·

1. ç‚¹å‡»"æ·»åŠ ç”¨æˆ·"æŒ‰é’®
2. å¡«å†™ç”¨æˆ·åã€å¯†ç 
3. å¯é€‰ï¼šå‹¾é€‰"ç®¡ç†å‘˜"åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
4. ç‚¹å‡»"åˆ›å»º"

#### åˆ é™¤ç”¨æˆ·

åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ç‚¹å‡»"åˆ é™¤"æŒ‰é’®ï¼Œç¡®è®¤ååˆ é™¤ç”¨æˆ·ã€‚

**æ³¨æ„ï¼š** åˆ é™¤ç”¨æˆ·ä¼šåŒæ—¶åˆ é™¤è¯¥ç”¨æˆ·çš„è‚¡ç¥¨åˆ—è¡¨ã€‚

## ğŸ“Š è‚¡ç¥¨åˆ—è¡¨ç®¡ç†

### ç”¨æˆ·è‚¡ç¥¨åˆ—è¡¨

æ¯ä¸ªç”¨æˆ·ç™»å½•åï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹è‡ªå·±çš„è‚¡ç¥¨åˆ—è¡¨** - é¦–é¡µæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„è‚¡ç¥¨åˆ—è¡¨
2. **ä¿®æ”¹è‡ªå·±çš„è‚¡ç¥¨åˆ—è¡¨** - åœ¨é¦–é¡µä¿®æ”¹ï¼Œåªå½±å“å½“å‰ç”¨æˆ·
3. **è§¦å‘åˆ†æ** - åˆ†æä»»åŠ¡ä½¿ç”¨å½“å‰ç”¨æˆ·çš„è‚¡ç¥¨åˆ—è¡¨

### æ•°æ®éš”ç¦»

- âœ… æ¯ä¸ªç”¨æˆ·çš„è‚¡ç¥¨åˆ—è¡¨å®Œå…¨ç‹¬ç«‹
- âœ… ç”¨æˆ·åªèƒ½çœ‹åˆ°å’Œä¿®æ”¹è‡ªå·±çš„è‚¡ç¥¨åˆ—è¡¨
- âœ… åˆ†æä»»åŠ¡ä½¿ç”¨å½“å‰ç”¨æˆ·çš„è‚¡ç¥¨åˆ—è¡¨

## ğŸ” è®¤è¯æ–¹å¼

### å¤šç”¨æˆ·æ¨¡å¼ï¼ˆæ¨èï¼‰

å½“ç³»ç»Ÿä¸­å­˜åœ¨ç”¨æˆ·æ—¶ï¼Œè‡ªåŠ¨å¯ç”¨å¤šç”¨æˆ·æ¨¡å¼ï¼š

1. **ç™»å½•é¡µé¢** - è®¿é—® `/login` è¿›è¡Œç™»å½•
2. **Session è®¤è¯** - ç™»å½•åä½¿ç”¨ Cookie Session ä¿æŒç™»å½•çŠ¶æ€
3. **è‡ªåŠ¨ç™»å½•** - 24å°æ—¶å†…æ— éœ€é‡å¤ç™»å½•

### å•ç”¨æˆ·æ¨¡å¼ï¼ˆå‘åå…¼å®¹ï¼‰

å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰ç”¨æˆ·ï¼Œä¸”é…ç½®äº† `WEBUI_USERNAME` å’Œ `WEBUI_PASSWORD`ï¼Œåˆ™ä½¿ç”¨ Basic Authï¼š

```bash
# .env
WEBUI_USERNAME=admin
WEBUI_PASSWORD=mypassword
```

## ğŸ“ API æ¥å£

### ç”¨æˆ·ç™»å½•

```http
POST /api/login
Content-Type: application/x-www-form-urlencoded

username=admin&password=mypassword
```

å“åº”ï¼š
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "user": {
    "id": 1,
    "username": "admin",
    "is_admin": true
  }
}
```

### ç”¨æˆ·ç™»å‡º

```http
GET /api/logout
```

### åˆ›å»ºç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰

```http
POST /api/admin/users
Content-Type: application/json

{
  "username": "user1",
  "password": "password123",
  "is_admin": false
}
```

### åˆ é™¤ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰

```http
DELETE /api/admin/users?id=1
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### users è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ |
| username | String(50) | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| password_hash | String(255) | å¯†ç å“ˆå¸Œ |
| enabled | Boolean | æ˜¯å¦å¯ç”¨ |
| is_admin | Boolean | æ˜¯å¦ç®¡ç†å‘˜ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ |

### user_stock_lists è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| user_id | Integer | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| stock_list | Text | è‚¡ç¥¨åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ |

## ğŸ”’ å®‰å…¨è¯´æ˜

### å¯†ç åŠ å¯†

- ä½¿ç”¨ SHA256 + Salt åŠ å¯†å¯†ç 
- æ¯ä¸ªå¯†ç ä½¿ç”¨éšæœº Salt
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ bcryptï¼ˆå¯è‡ªè¡Œä¿®æ”¹ï¼‰

### Session å®‰å…¨

- Session ID ä½¿ç”¨ `secrets.token_urlsafe(32)` ç”Ÿæˆ
- Session 24å°æ—¶è¿‡æœŸ
- Cookie ä½¿ç”¨ HttpOnly æ ‡å¿—

### æƒé™æ§åˆ¶

- æ™®é€šç”¨æˆ·åªèƒ½ç®¡ç†è‡ªå·±çš„è‚¡ç¥¨åˆ—è¡¨
- ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ‰€æœ‰ç”¨æˆ·
- ç”¨æˆ·ç®¡ç†åŠŸèƒ½éœ€è¦ç®¡ç†å‘˜æƒé™

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡ä½¿ç”¨** - å¿…é¡»ä½¿ç”¨ `init_admin.py` åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
2. **æ•°æ®è¿ç§»** - å¦‚æœä»å•ç”¨æˆ·æ¨¡å¼è¿ç§»ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºç”¨æˆ·
3. **å¯†ç é‡ç½®** - ç›®å‰ä¸æ”¯æŒå¯†ç é‡ç½®ï¼Œéœ€è¦ç®¡ç†å‘˜åˆ é™¤åé‡å»º
4. **Session å­˜å‚¨** - å½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œé‡å¯å Session å¤±æ•ˆ

## ğŸ› æ•…éšœæ’é™¤

### æ— æ³•ç™»å½•

1. æ£€æŸ¥æ˜¯å¦å·²åˆ›å»ºç”¨æˆ·ï¼š`python -c "from src.user_service import get_user_service; print(len(get_user_service().list_users()))"`
2. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æ­£å¸¸ï¼šæŸ¥çœ‹ `data/stock_analysis.db` æ˜¯å¦å­˜åœ¨
3. æ£€æŸ¥æ—¥å¿—ï¼šæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### ç”¨æˆ·åˆ—è¡¨ä¸ºç©º

å¦‚æœç”¨æˆ·åˆ—è¡¨ä¸ºç©ºï¼Œç³»ç»Ÿä¼šå›é€€åˆ°å•ç”¨æˆ· Basic Auth æ¨¡å¼ã€‚

### Session å¤±æ•ˆ

å¦‚æœ Session å¤±æ•ˆï¼Œéœ€è¦é‡æ–°ç™»å½•ã€‚Session åœ¨ä»¥ä¸‹æƒ…å†µä¼šå¤±æ•ˆï¼š
- 24å°æ—¶æœªè®¿é—®
- æœåŠ¡å™¨é‡å¯ï¼ˆå†…å­˜å­˜å‚¨ï¼‰
- æ‰‹åŠ¨ç™»å‡º

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](DEPLOY.md)
- [å®‰å…¨åˆ†ææŠ¥å‘Š](SECURITY.md)
- [å®Œæ•´é…ç½®æŒ‡å—](full-guide.md)

---

**æœ€åæ›´æ–°ï¼š** 2026-01-26
